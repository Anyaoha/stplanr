---
title: "stplanr"
output:
  html_document:
    keep_md: yes
---

[![Build Status](https://travis-ci.org/Robinlovelace/stplanr.svg?branch=master)](https://travis-ci.org/Robinlovelace/stplanr) [![CRAN_Status_Badge](http://www.r-pkg.org/badges/version/stplanr)](http://cran.r-project.org/web/packages/stplanr)

```{r, echo=FALSE}
library(stplanr)
```


This is a package for sustainable transport planning in R (stplanr).

It brings together a range of tools for transport planning practitioners and
researchers to better understand transport systems and inform policy.

The initial work on the project was funded by the Department of Transport
([DfT](https://www.gov.uk/government/organisations/department-for-transport))
as part of the National Propensity to Cycle Tool
([NPCT](http://www.cedar.iph.cam.ac.uk/research/modelling/npct-tool/)) project to
identify where bicycle paths are most urgently needed.

## Key functions

Square data frames representing flows between origins and destinations
must be combined with geo-referenced zones or points to generate meaningful
analyses and visualisations of flows. **stplanr** facilitates this with 
`od2line()`, which takes flow and geographical data as inputs and
outputs a `SpatialLinesDataFrame`. Some example data is provided in the package:

```{r, results='hide', message=FALSE}
library(stplanr)
data(cents, flow)
```

Let's take a look at this data:

```{r}
flow[1:3, 1:3] # typical form of flow data
cents[1:3,] # points representing origins and destinations
```

These datasets can be combined as follows:

```{r plot1}
travel_network <- od2line(flow = flow, zones = cents)
w <- flow$All / max(flow$All) *10
plot(travel_network, lwd = w)
```

The package can also allocate flows to the travel network, for example through
a link to the [CycleStreets.net API](https://www.cyclestreets.net/api/):

```{r plot2, results='hide', message=FALSE}
example("line2route")
```

## Installation

```{r, eval=FALSE}
# you must have the devtools package (e.g. via install.packages("devtools"))
devtools::install_github("robinlovelace/stplanr")
library(stplanr)
```

## Getting help

We aim to make this package well-documented to make it easy to use.
R's internal help functions will help here:

```{r}
?route_cyclestreet # get help on an stplanr function
mytoken <- readLines("file:///C:/Users/georl/Dropbox/dotfiles/cyclestreets-api-key-rl")
Sys.setenv(CYCLESTREET = mytoken)
trip_to_pub <- route_cyclestreet(from = "Weobley", to = "Hereford", plan = "balanced")
# devtools::install_github("mtennekes/tmap", subdir = "pkg")
# library(tmap)
# osm_tiles <- read_osm(bb(trip_to_pub, ext=1.5, projection ="longlat"))
plot(trip_to_pub)
lsf.str("package:stplanr", all = TRUE)
```

Any questions?

Email me on rob00 x at gmail dot com!


